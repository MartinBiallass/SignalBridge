<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignalBridge Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/script.js" defer></script>
</head>
<body data-section="{{ section }}">
    <div class="container">
        <div class="language-switcher">
            <form id="language-form" method="POST" action="/set_language">
                <label for="language-select">{{ translations['select_area'] }}</label>
                <select id="language-select" name="language" onchange="changeLanguage()">
                    <option value="de" {{ 'selected' if lang == 'de' else '' }}>Deutsch</option>
                    <option value="en" {{ 'selected' if lang == 'en' else '' }}>English</option>
                </select>
            </form>
        </div>

        <div class="sidebar">
            <img src="/static/logo.png" alt="SignalBridge Logo" class="logo">
            <a href="/" class="{{ 'active' if section == 'home' else '' }}" data-section="home">{{ translations['home'] }}</a>
            <a href="/linked-accounts" class="{{ 'active' if section == 'linked_accounts' else '' }}" data-section="linked_accounts">{{ translations['linked_accounts'] }}</a>
            <a href="/account-management" class="{{ 'active' if section == 'account_management' else '' }}" data-section="account_management">{{ translations['account_management'] }}</a>
            <a href="/message-history" class="{{ 'active' if section == 'message_history' else '' }}" data-section="message_history">{{ translations['message_history'] }}</a>
            <a href="/system-cockpit" class="{{ 'active' if section == 'system_cockpit' else '' }}" data-section="system_cockpit">System Cockpit</a>
            <a href="/backtest" class="{{ 'active' if section == 'backtest' else '' }}" data-section="backtest">{{ translations['backtest'] }}</a>
            <a href="/support" class="{{ 'active' if section == 'support' else '' }}" data-section="support">{{ translations['support'] }}</a>
            <a href="/help" class="{{ 'active' if section == 'help' else '' }}" data-section="help">{{ translations['help'] }}</a>
        </div>

        <div class="main-content">
            {% if section == 'system_cockpit' %}
            <div class="system-status">
                <h2>{{ translations['health_check'] }}</h2>
                <ul>
                    <li>Telegram Status: {{ system_status.telegram_status }}</li>
                    <li>Server Status: {{ system_status.server_status }}</li>
                    <li>Lokaler Server Status: {{ system_status.local_server_status }}</li>
                    <li>API Status: {{ system_status.api_status }}</li>
                    <li>Software Version: {{ system_status.software_version }}</li>
                    <li>Analyzer Version: {{ system_status.analyzer_version }}</li>
                    <li>Functions Version: {{ system_status.functions_version }}</li>
                    <li>Interface Version: {{ system_status.interface_version }}</li>
                </ul>
                <p><span class="ram-status {{ ram_status }}"></span> Nutzung: {{ current_ram }} / {{ total_ram }}</p>
            </div>

            {% elif section == 'message_history' %}
            <div class="message-history">
                <h2>{{ translations['message_history'] }}</h2>
                <form method="GET" action="/message-history">
                    <label for="channel">Kanal:</label>
                    <select id="channel" name="channel">
                        <option value="all" {{ 'selected' if selected_channel == 'all' else '' }}>Alle Kan채le</option>
                        {% for channel in channels %}
                        <option value="{{ channel }}" {{ 'selected' if selected_channel == channel else '' }}>{{ channel }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit">Filtern</button>
                </form>
                <table>
                    <thead>
                        <tr>
                            <th>Zeit</th>
                            <th>Kanal</th>
                            <th>Nachricht</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for msg in messages %}
                        <tr>
                            <td>{{ msg.timestamp }}</td>
                            <td>{{ msg.channel }}</td>
                            <td>{{ msg.message }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif section == 'linked_accounts' %}
            <div class="linked-accounts">
                <h2>{{ translations['linked_accounts'] }}</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Konto</th>
                            <th>Plattform</th>
                            <th>Status</th>
                            <th>Aktionen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for account in accounts %}
                        <tr>
                            <td>{{ account.name }}</td>
                            <td>{{ account.platform }}</td>
                            <td>{{ account.status }}</td>
                            <td>
                                <button>Bearbeiten</button>
                                <button>Entfernen</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% elif section == 'backtest' %}
            <div class="coming-soon">
                <h2>Coming Soon</h2>
                <p>Diese Funktionalit채t wird in einer zuk체nftigen Premium-Version verf체gbar sein.</p>
                <p class="coming-soon-note">Upgrade auf Premium, um Zugriff auf diese Funktion zu erhalten!</p>
            </div>

            {% elif section == 'support' %}
            <div class="support">
                <h2>{{ translations['support'] }}</h2>
                <form method="POST" action="/support" enctype="multipart/form-data">
                    <label for="subject">Betreff:</label>
                    <input type="text" id="subject" name="subject" required>
                    <label for="description">Beschreibung:</label>
                    <textarea id="description" name="description" required></textarea>
                    <label for="attachment">Dateianhang:</label>
                    <input type="file" id="attachment" name="attachment">
                    <button type="submit">Anfrage senden</button>
                </form>
            </div>

            {% elif section == 'help' %}
            <div class="help">
                <h2>{{ translations['help'] }}</h2>
                <div class="faq-grid">
                    {% for faq in faqs %}
                    <div class="faq-tile" data-faq="{{ faq.id }}">
                        <h3>{{ faq.title }}</h3>
                    </div>
                    <div id="{{ faq.id }}" class="modal hidden">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h3>{{ faq.title }}</h3>
                            <p>{{ faq.content }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {% else %}
            <h1>{{ translations['welcome'] }}</h1>
            <p>{{ translations['select_area'] }}</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
